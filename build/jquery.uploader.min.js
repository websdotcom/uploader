(function(a){a.uploader=function(c,b){if(this==window){return new a.uploader(c,b)}return this.init(c,b)};a.extend(a.uploader.prototype,{init:function(d,c){var b=this;this.$el=a(d);this.$el.data("uploader",this);this.options=a.extend(true,{},a.uploader.defaultOptions,c);this.inputs=[];this.addLabel=a("<label>").text("Upload another file").addClass(this.options.html.addLabelClass).insertAfter(this.$el).click(a.proxy(b,"addFile"));this.render();return this},render:function(){this.$el.hide();this.addFile();this.hiddenField=a("<input type='hidden'>").addClass(this.options.hiddenFieldName).insertBefore(this.$el)},canAddFile:function(){return this.options.nextIndex<=this.options.maxNumber},addFile:function(){if(!this.canAddFile()){return false}var c=this.options.nextIndex,b=this,d=a("<input type='file'>").addClass(this.options.inputClass);this.addLabel.hide();this.inputs.push(d);d.insertBefore(this.$el).bind("change",{input:d},a.proxy(b,"onFileSelected"));this.options.nextIndex++;if(this.canAddFile()){this.addLabel.show()}return this.inputs[this.inputs.length-1]},onFileSelected:function(b){if(!(b.data&&typeof(b.data.input)=="Object")){return}this.sendFile(b.data.input)},pickTransport:function(){return a.uploader.transports.iframe},sendFile:function(b){this.pickTransport()(b,this.options.action,this.options.callback)}});a.uploader.defaultOptions={html:{addLabelClass:"uploader-add-label",inputClass:"uploader-input",hiddenFieldName:"uploader-file-ids"},maxNumber:1,addLabel:"Add another",nextIndex:1,action:"/",callback:function(){}};a.fn.uploader=function(b){return this.each(function(){return new a.uploader(this,b)})};a.uploader.transports={iframe:function(h,c,i){var f=idGen("uploader-iframe-"),j=a("<iframe>"),g=a(h),k=a("<form>"),d=k.attr("action"),e=k.attr("target"),b=function(){if(!i){return}i(j);k.remove();j.remove();i=undefined};j.attr("id",f).css({position:"absolute",top:-10000,left:-10000}).appendTo("body");k.attr("encoding","multipart/form-data").attr("enctype","multipart/form-data").attr("action",c).attr("target",f).css({position:"absolute",top:-10000,left:-10000}).appendTo("body").append(g).submit();setTimeout(b,5000);j.load(g,b)}};idGen=(function(){idNames={};return function(b){return b+(idNames[b]=(idNames[b]||0)+1)}})()})(jQuery);
